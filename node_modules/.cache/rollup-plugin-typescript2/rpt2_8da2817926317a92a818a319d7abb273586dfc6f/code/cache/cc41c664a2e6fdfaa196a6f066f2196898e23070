{"code":"import * as tslib_1 from \"tslib\";\r\nimport { DirectiveOutpost } from '../directives/colony/outpost';\r\nimport { DirectiveSKOutpost } from '../directives/colony/outpostSK';\r\nimport { profile } from '../profiler/decorator';\r\n/**\r\n * GameCache does initial low-level preprocessing before each tick is run\r\n */\r\nlet GameCache = class GameCache {\r\n    constructor() {\r\n        this.overlords = {};\r\n        this.creepsByColony = {};\r\n        this.targets = {};\r\n        this.outpostFlags = _.filter(Game.flags, flag => DirectiveOutpost.filter(flag)\r\n            || DirectiveSKOutpost.filter(flag));\r\n    }\r\n    cacheCreepsByColony() {\r\n        this.creepsByColony = _.groupBy(Game.creeps, creep => creep.memory[\"C\" /* COLONY */]);\r\n    }\r\n    /**\r\n     * Generates a hash table for creeps assigned to each object: key: OLref, val: (key: role, val: names[])\r\n     */\r\n    cacheOverlords() {\r\n        this.overlords = {};\r\n        // keys: overlordRef, value: creepNames[]\r\n        const creepNamesByOverlord = _.groupBy(_.keys(Game.creeps), name => Game.creeps[name].memory[\"O\" /* OVERLORD */]);\r\n        for (const ref in creepNamesByOverlord) {\r\n            // keys: roleName, value: creepNames[]\r\n            this.overlords[ref] = _.groupBy(creepNamesByOverlord[ref], name => Game.creeps[name].memory.role);\r\n        }\r\n    }\r\n    /**\r\n     * Generates a hash table for targets: key: TargetRef, val: targeting creep names\r\n     */\r\n    cacheTargets() {\r\n        this.targets = {};\r\n        for (const i in Game.creeps) {\r\n            const creep = Game.creeps[i];\r\n            let task = creep.memory.task;\r\n            while (task) {\r\n                if (!this.targets[task._target.ref])\r\n                    this.targets[task._target.ref] = [];\r\n                this.targets[task._target.ref].push(creep.name);\r\n                task = task._parent;\r\n            }\r\n        }\r\n    }\r\n    build() {\r\n        this.cacheCreepsByColony();\r\n        this.cacheOverlords();\r\n        this.cacheTargets();\r\n    }\r\n    refresh() {\r\n        this.cacheCreepsByColony();\r\n        this.cacheOverlords();\r\n        this.cacheTargets();\r\n    }\r\n};\r\nGameCache = tslib_1.__decorate([\r\n    profile\r\n], GameCache);\r\nexport { GameCache };\r\n","references":["C:/git/Overmind/src/directives/colony/outpost.ts","C:/git/Overmind/src/directives/colony/outpostSK.ts","C:/git/Overmind/src/profiler/decorator.ts"]}
